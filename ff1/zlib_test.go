package ff1

import (
	"bytes"
	"encoding/base64"
	"io"
	"log"

	"testing"
)

const (
	CarDataZ1 = "7ZbBasMwDED/xeeuSLJsy7mW/cF22dihjMIGo4eut5B/b+K0JVCTpQ6jJhiCHYKfI0vxi2v1vD8evne/qnqv1evxU1WKgPQTtJd5QVsxVhrXTB685Te1UpvtoR1dK+yazdd2v9/9hAegKlgpCq0OLYfW9Pdd1zRhwAQOgQMZ+ivLM1iECOyc2MAjUphBhxnE3ISNqevFWUHbP2CMwxhgSS1RLFWTwGlJiq+VYl+GgMC5QDwoUOTVOkJbsCbQQuPwnBqRS8yWnpMtTgxZOtiYO0JGGAZtY3meGrSLpYovJR7PliRmq90KLT4mNwcejFme29q9E3ObLW7Lw21Orj8fTHGb7mkZwrq4LS+3MT7UbZ49oF/gwU1M9OBW5JaL3CxTXyDw98vNeA+3cnNFbjnJTWt5pNxoTSTeuQXKzQOc5aaL3HKUm9EXubmEkxti5OTmi9xykhsy/bvcPpoT"
	CarData1  = `{"Entries":[{"Utc":"2023-03-05T16:41:31.4290964Z","Cars":{"1":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":0,"45":0}},"2":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"4":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"10":{"Channels":{"0":7786,"2":112,"3":3,"4":85,"5":0,"45":0}},"11":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":0,"45":0}},"14":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"16":{"Channels":{"0":0,"2":0,"3":1,"4":104,"5":104,"45":1}},"18":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":0,"45":0}},"20":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":0,"45":0}},"21":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"22":{"Channels":{"0":8080,"2":114,"3":3,"4":0,"5":0,"45":0}},"23":{"Channels":{"0":6065,"2":82,"3":3,"4":0,"5":0,"45":0}},"24":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"27":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":0,"45":0}},"31":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"44":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":8}},"55":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":100,"45":0}},"63":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"77":{"Channels":{"0":4080,"2":0,"3":0,"4":0,"5":0,"45":0}},"81":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":1}}}},{"Utc":"2023-03-05T16:41:31.709055Z","Cars":{"1":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":0,"45":0}},"2":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"4":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"10":{"Channels":{"0":7808,"2":112,"3":3,"4":86,"5":0,"45":0}},"11":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":0,"45":0}},"14":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"16":{"Channels":{"0":0,"2":0,"3":1,"4":104,"5":104,"45":1}},"18":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":0,"45":0}},"20":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":0,"45":0}},"21":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"22":{"Channels":{"0":7886,"2":111,"3":3,"4":0,"5":0,"45":0}},"23":{"Channels":{"0":6036,"2":81,"3":3,"4":3,"5":0,"45":0}},"24":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"27":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":0,"45":0}},"31":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"44":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":8}},"55":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":100,"45":0}},"63":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"77":{"Channels":{"0":4041,"2":0,"3":0,"4":0,"5":0,"45":0}},"81":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":1}}}},{"Utc":"2023-03-05T16:41:31.9490194Z","Cars":{"1":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":0,"45":0}},"2":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"4":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"10":{"Channels":{"0":7856,"2":112,"3":3,"4":86,"5":0,"45":0}},"11":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":0,"45":0}},"14":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"16":{"Channels":{"0":0,"2":0,"3":1,"4":104,"5":104,"45":1}},"18":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":0,"45":0}},"20":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":0,"45":0}},"21":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"22":{"Channels":{"0":7642,"2":109,"3":3,"4":0,"5":0,"45":0}},"23":{"Channels":{"0":5990,"2":81,"3":3,"4":7,"5":0,"45":0}},"24":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"27":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":0,"45":0}},"31":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"44":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":8}},"55":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":100,"45":0}},"63":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"77":{"Channels":{"0":3381,"2":0,"3":0,"4":0,"5":0,"45":0}},"81":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":1}}}},{"Utc":"2023-03-05T16:41:32.2289774Z","Cars":{"1":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":0,"45":0}},"2":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"4":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"10":{"Channels":{"0":7900,"2":113,"3":3,"4":86,"5":0,"45":0}},"11":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":0,"45":0}},"14":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"16":{"Channels":{"0":0,"2":0,"3":1,"4":104,"5":104,"45":1}},"18":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":0,"45":0}},"20":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":0,"45":0}},"21":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"22":{"Channels":{"0":7532,"2":107,"3":3,"4":0,"5":0,"45":0}},"23":{"Channels":{"0":6116,"2":81,"3":3,"4":9,"5":0,"45":0}},"24":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"27":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":0,"45":0}},"31":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"44":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":8}},"55":{"Channels":{"0":0,"2":0,"3":0,"4":0,"5":100,"45":0}},"63":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":0}},"77":{"Channels":{"0":1421,"2":0,"3":0,"4":0,"5":0,"45":0}},"81":{"Channels":{"0":0,"2":0,"3":0,"4":104,"5":104,"45":1}}}}]}`
)

func TestCarData(t *testing.T) {
	var (
		in, out []byte
		r       io.ReadCloser
		err     error
	)
	// Decode base64-encoded input
	if in, err = base64.StdEncoding.DecodeString(CarDataZ1); err != nil {
		t.Error(err)
		return
	}
	// Decompress using zlib
	buffer := bytes.NewReader(in)
	if r, err = NewReader(buffer); err != nil {
		t.Error(err)
		return
	}
	defer r.Close()
	if out, err = io.ReadAll(r); err != nil {
		t.Error(err)
		return
	}
	if string(out) != CarData1 {
		log.Println(string(out))
		log.Println(CarData1)
		t.Error("decoded string different from ref")
	}
	return

}
